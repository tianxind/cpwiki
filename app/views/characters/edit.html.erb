<%= form_for @character, url: character_path(@character.id), method: :put do |form| %>
    <% @character.errors.full_messages.each do |msg| %>
      	<div><span class="error_msg"><%= msg %></span></div>
    <% end %>
	<table>
	    <tr>
	      <td><%= form.label(:name, "姓名:")%></td>
		  <td><%= form.text_field :name %></td>
	    </tr>
	    <tr>
	      <td><%= form.label(:nickname, "别名:")%></td>
	      <td><%= form.text_field :nickname %></td>
	    </tr>
	    <tr>
	      <td><%= form.label(:work, "出自作品:")%></td>
	      <td><%= form.text_field :work %></td>
	    </tr>
	    <tr>
	      <td><%= form.label(:birth_date, "生日:")%></td>
	      <td><%= form.text_field :birth_date %></td>
	    </tr>
	    <tr>
	      <td><%= form.label(:sex, "性别:")%></td>
		  <td>
			  <select name="sex" id="sex_type">
				    <option value="男">男</option>
				    <option value="女">女</option>
				    <option value="不明">不明</option>
				    <option value="其他">其他</option>
					</select>
			  <span id="otherSexType" style="display:none;">
				  <input id="otherSex" type="text" name="sex" placeholder="请指定性别"/>
				</span>
		  </td>
	    </tr>
	    <tr>
	      <td><%= form.label(:horoscope, "星座:")%></td>
	      <td><%= form.select(:horoscope, Character::HOROSCOPE) %>
		  </td>
	    </tr>
	    <tr>
	      <td><%= form.label(:blood_type, "血型:")%></td>
	      <td><%= form.select(:blood_type, Character::BLOODTYPE) %></td>
	    </tr>
	    <tr>
	      <td><%= form.label(:occupation, "职业:")%></td>
	      <td><%= form.text_field(:occupation) %></td>
	    </tr>
	    <tr>
	      <td><%= form.label(:height, "身高:")%></td>
	      <td><%= form.text_field(:height) %></td>
	    </tr>
	    <tr>
	      <td><%= form.label(:weight, "体重:")%></td>
	      <td><%= form.text_field(:weight) %></td>
	    </tr>
	    <tr>
	      <td><%= form.label(:eye, "瞳色:")%></td>
	      <td><%= form.text_field(:eye) %></td>
	    </tr>
	    <tr>
	      <td><%= form.label(:hair, "发色:")%></td>
	      <td><%= form.text_field(:hair) %></td>
	    </tr>
	</table>
	<div>
		<%= form.label(:summary, "简介:")%>			
		<%= render "shared/editor" %>
	</div>
  <%= form.hidden_field :summary %>
  <% if params[:fromcp] %>
  	<%= hidden_field_tag :fromcp, params[:fromcp] %>
  <% end %> 
  <%= form.submit %>
<% end %>

<script type="text/javascript">
	var editor = $(".edit_area")[0];
	var initialText = "";
	<% if @character.summary != nil && !@character.summary.empty? %>
		initialText = '<%= formatted(@character.summary) %>';
	<% end %>
	myEditor.makeEditor(editor, initialText);
	// Put html source into hidden text area before submit
	$(".edit_character").submit( function() {
		console.log("before submit");
		$("#character_summary").val(editor.innerHTML);
		console.log($("#character_summary").val());
	});
</script>
<input type="hidden" id="current_user" value=<%= current_user.id %> />
<input type="hidden" id="saved_filename" value="" />
 
<%= link_to 'Back', character_path(@character.id) %>


<script>
// select correct sex
$("select#sex_type option").each(function() { 
	var sex = '<%= @character.sex %>';
	this.selected = (this.text == sex); 
});

// change type of sex in selection box
$('#sex_type').on('change',function(){
	  console.log("i'm in changing sex type")
    var selection = $(this).val();
    switch(selection){
	    case "其他":
	    $("#otherSexType").show()
	    break;
	    default:
	    $("#otherSexType").hide()
    }
});

// change sex type to others and specify by user input
$(document).ready(function() {
   $('#otherSex').keyup(function () { 
   		console.log("in sex textfield change");
   		$("#sex_type").val($(this).text());
   });
});

// warn user when user leave this page except submitting the form
$('input[name=commit]').click(function() {
  window.submit_button_clicked = true;
});

$(window).bind('beforeunload', function(){
	if(!window.submit_button_clicked){
  	return '确定要离开此创建页面?';
  }
});

</script>














